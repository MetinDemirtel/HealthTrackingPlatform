<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saƒülƒ±k Takip Platformu</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #0a0a0a;
            min-height: 100vh;
            padding: 24px 20px;
            -webkit-font-smoothing: antialiased;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        .header {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 32px 40px;
            margin-bottom: 24px;
            border: 1px solid rgba(0, 0, 0, 0.06);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
            position: relative;
            overflow: hidden;
        }
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6 0%, #60a5fa 50%, #3b82f6 100%);
        }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 28px; font-weight: 800; letter-spacing: -0.03em; margin-bottom: 6px; }
        .header p { color: #6c757d; font-size: 14px; font-weight: 500; }
        .help-btn {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: rgba(59, 130, 246, 0.12);
            border: 1px solid rgba(59, 130, 246, 0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 800;
            color: #3b82f6;
            transition: all 0.2s;
        }
        .help-btn:hover { background: rgba(59, 130, 246, 0.18); transform: translateY(-2px); }
        .grid { display: grid; grid-template-columns: 380px 1fr; gap: 24px; }
        .card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 28px;
            border: 1px solid rgba(0, 0, 0, 0.06);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
        }
        .card-title { font-size: 18px; font-weight: 800; letter-spacing: -0.02em; margin-bottom: 4px; }
        .card-subtitle { color: #6c757d; font-size: 13px; font-weight: 600; margin-bottom: 24px; }
        .input-group { margin-bottom: 20px; }
        .input-label { display: block; color: #495057; font-size: 13px; font-weight: 700; margin-bottom: 8px; }
        .input-wrapper { position: relative; }
        .input-icon { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: #adb5bd; font-size: 16px; }
        input, select {
            width: 100%;
            padding: 16px 16px 16px 44px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.08);
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            color: #0a0a0a;
            font-family: inherit;
            transition: all 0.2s;
        }
        input[type="date"], input.no-icon { padding: 16px; }
        input:focus, select:focus {
            outline: none;
            border-color: #3b82f6;
            background: white;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12'%3E%3Cpath fill='%236c757d' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            cursor: pointer;
        }
        .btn {
            width: 100%;
            padding: 16px 24px;
            background: rgba(59, 130, 246, 0.12);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            font-size: 15px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 8px;
        }
        .btn:hover { background: rgba(59, 130, 246, 0.18); transform: translateY(-1px); }
        .btn-success { background: rgba(16, 185, 129, 0.12); color: #10b981; border-color: rgba(16, 185, 129, 0.3); }
        .btn-success:hover { background: rgba(16, 185, 129, 0.18); }
        .btn-danger { background: rgba(239, 68, 68, 0.12); color: #ef4444; border-color: rgba(239, 68, 68, 0.3); }
        .btn-danger:hover { background: rgba(239, 68, 68, 0.18); }
        .info {
            background: rgba(59, 130, 246, 0.05);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-left: 3px solid #3b82f6;
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
        }
        .info-title { color: #3b82f6; font-size: 13px; font-weight: 700; margin-bottom: 8px; }
        .info p { color: #6c757d; font-size: 13px; line-height: 1.6; margin-bottom: 6px; font-weight: 500; }
        .motivation {
            background: rgba(16, 185, 129, 0.05);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-left: 3px solid #10b981;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            text-align: center;
            font-size: 15px;
            font-weight: 600;
        }
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 24px; }
        .stat {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 0, 0, 0.06);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.2s;
        }
        .stat:hover { transform: translateY(-2px); border-color: rgba(59, 130, 246, 0.3); }
        .stat-label { color: #6c757d; font-size: 12px; font-weight: 700; margin-bottom: 10px; }
        .stat-value { font-size: 28px; font-weight: 900; letter-spacing: -0.03em; }
        .stat-unit { color: #6c757d; font-size: 16px; font-weight: 700; margin-left: 4px; }
        .achievements { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-top: 16px; }
        .achievement {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.06);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            opacity: 0.3;
            transition: all 0.2s;
        }
        .achievement.unlocked {
            opacity: 1;
            border-color: rgba(16, 185, 129, 0.3);
            background: rgba(16, 185, 129, 0.05);
        }
        .achievement.unlocked:hover { transform: translateY(-4px) scale(1.05); }
        .achievement-icon { font-size: 32px; margin-bottom: 8px; }
        .achievement-name { font-size: 11px; font-weight: 700; color: #6c757d; text-transform: uppercase; }
        .achievement.unlocked .achievement-name { color: #10b981; }
        .tracker {
            background: rgba(59, 130, 246, 0.05);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 16px;
            padding: 20px;
            margin-top: 20px;
        }
        .tracker-header { display: flex; justify-content: space-between; margin-bottom: 16px; }
        .tracker-goal { color: #3b82f6; font-size: 13px; font-weight: 700; }
        .tracker-progress { background: rgba(255, 255, 255, 0.5); border-radius: 8px; height: 12px; overflow: hidden; margin-bottom: 12px; }
        .tracker-fill { height: 100%; background: linear-gradient(90deg, #3b82f6 0%, #60a5fa 100%); transition: width 0.3s; border-radius: 8px; }
        .tracker-btns { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .tracker-btn {
            padding: 10px;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 8px;
            font-size: 13px;
            font-weight: 700;
            color: #3b82f6;
            cursor: pointer;
            transition: all 0.2s;
        }
        .tracker-btn:hover { background: rgba(59, 130, 246, 0.1); transform: translateY(-1px); }
        .tracker.calorie { background: rgba(16, 185, 129, 0.05); border-color: rgba(16, 185, 129, 0.2); }
        .tracker.calorie .tracker-goal { color: #10b981; }
        .tracker.calorie .tracker-fill { background: linear-gradient(90deg, #10b981 0%, #059669 100%); }
        .tracker.calorie .tracker-btn { color: #10b981; border-color: rgba(16, 185, 129, 0.2); }
        .measurements { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 16px; }
        .measurements input { padding: 12px 12px 12px 36px; font-size: 14px; }
        .measurements .input-icon { font-size: 14px; left: 12px; }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            z-index: 1000;
            padding: 40px 20px;
            overflow-y: auto;
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal-content {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            border: 1px solid rgba(0, 0, 0, 0.08);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            position: relative;
            animation: slideUp 0.4s;
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }
        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.05);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #6c757d;
            transition: all 0.2s;
        }
        .close-btn:hover { background: rgba(0, 0, 0, 0.1); }
        .guide-step {
            display: flex;
            gap: 20px;
            margin-bottom: 24px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 16px;
            border: 1px solid rgba(0, 0, 0, 0.06);
        }
        .guide-num {
            flex-shrink: 0;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: rgba(59, 130, 246, 0.12);
            border: 1px solid rgba(59, 130, 246, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 900;
            color: #3b82f6;
        }
        .guide-step h3 { font-size: 16px; font-weight: 800; margin-bottom: 8px; }
        .guide-step p { color: #6c757d; font-size: 14px; line-height: 1.6; }
        .formula {
            background: rgba(16, 185, 129, 0.05);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-left: 3px solid #10b981;
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
            font-family: 'Courier New', monospace;
        }
        .formula code { color: #10b981; font-weight: 700; font-size: 13px; display: block; margin: 4px 0; }
        .entries { max-height: 400px; overflow-y: auto; margin-top: 20px; }
        .entry {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.06);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.2s;
        }
        .entry:hover { border-color: rgba(59, 130, 246, 0.3); transform: translateX(4px); }
        .entry-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .entry-date { color: #6c757d; font-size: 13px; font-weight: 700; }
        .entry-weight { font-size: 18px; font-weight: 900; }
        .entry-details { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 12px; }
        .entry-detail { background: rgba(0, 0, 0, 0.02); padding: 8px 12px; border-radius: 8px; }
        .entry-detail-label { color: #6c757d; font-size: 10px; font-weight: 700; text-transform: uppercase; margin-bottom: 4px; }
        .entry-detail-value { font-size: 13px; font-weight: 800; }
        .progress {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.06);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
        }
        .progress-bar { background: rgba(0, 0, 0, 0.05); border-radius: 8px; height: 12px; overflow: hidden; margin-top: 12px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #10b981 0%, #059669 100%); transition: width 0.5s; border-radius: 8px; }
        .bmi {
            background: rgba(59, 130, 246, 0.05);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }
        .bmi-value { color: #3b82f6; font-size: 32px; font-weight: 900; margin-bottom: 4px; }
        .bmi-cat { color: #6c757d; font-size: 13px; font-weight: 700; }
        .export-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 16px; }
        .credit {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 12px;
            border: 1px solid rgba(0, 0, 0, 0.06);
        }
        .credit p { color: #6c757d; font-size: 13px; margin-bottom: 4px; }
        .credit .name { color: #0a0a0a; font-size: 16px; font-weight: 800; }
        .hidden { display: none; }
        @media (max-width: 1024px) {
            .grid { grid-template-columns: 1fr; }
            .stats { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 640px) {
            .header-content { flex-direction: column; gap: 16px; }
            .stats, .achievements { grid-template-columns: 1fr; }
            .export-btns { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div>
                    <h1>üéØ Saƒülƒ±k Takip Platformu</h1>
                    <p>Hedeflerine ula≈ümak i√ßin kapsamlƒ± takip sistemi</p>
                </div>
                <button class="help-btn" onclick="showGuide()">?</button>
            </div>
        </div>

        <!-- Setup -->
        <div id="setup">
            <div class="grid">
                <div class="card">
                    <h2 class="card-title">Ba≈ülangƒ±√ß Bilgileri</h2>
                    <p class="card-subtitle">Ki≈üiselle≈ütirilmi≈ü takip i√ßin</p>
                    <form id="setupForm">
                        <div class="input-group">
                            <label class="input-label">Cinsiyet</label>
                            <div class="input-wrapper">
                                <span class="input-icon">üë§</span>
                                <select id="gender" required>
                                    <option value="">Se√ßiniz</option>
                                    <option value="male">Erkek</option>
                                    <option value="female">Kadƒ±n</option>
                                </select>
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Ya≈ü</label>
                            <div class="input-wrapper">
                                <span class="input-icon">üéÇ</span>
                                <input type="number" id="age" min="15" max="100" placeholder="25" required>
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Ba≈ülangƒ±√ß Tarihi</label>
                            <input type="date" id="startDate" required>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Hedef Tarihi</label>
                            <input type="date" id="targetDate" required>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Boy (cm)</label>
                            <div class="input-wrapper">
                                <span class="input-icon">üìè</span>
                                <input type="number" id="height" step="0.1" placeholder="175" required>
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Ba≈ülangƒ±√ß Kilosu (kg)</label>
                            <div class="input-wrapper">
                                <span class="input-icon">‚öñÔ∏è</span>
                                <input type="number" id="startWeight" step="0.1" placeholder="80.5" required>
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Hedef Kilo (kg)</label>
                            <div class="input-wrapper">
                                <span class="input-icon">üéØ</span>
                                <input type="number" id="targetWeight" step="0.1" placeholder="75.0" required>
                            </div>
                        </div>
                        <button type="submit" class="btn">Ba≈üla</button>
                    </form>
                    <div class="info">
                        <div class="info-title">üí° Bilgi</div>
                        <p>T√ºm veriler cihazƒ±nƒ±zda g√ºvenle saklanƒ±r</p>
                        <p>Ki≈üiselle≈ütirilmi≈ü su ve kalori hedefleri</p>
                        <p>8 ba≈üarƒ± rozeti kazanƒ±n</p>
                    </div>
                </div>
                <div class="card">
                    <h2 class="card-title">√ñzellikler</h2>
                    <p class="card-subtitle">Neler yapabilirsiniz?</p>
                    <div class="info" style="margin-top: 0;">
                        <div class="info-title">üìä Kilo Takibi</div>
                        <p>G√ºnl√ºk kilo & BMI hesaplama</p>
                        <p>Akƒ±llƒ± runrate tahminleri</p>
                    </div>
                    <div class="info">
                        <div class="info-title">üíß Su & Kalori</div>
                        <p>Ki≈üiselle≈ütirilmi≈ü hedefler</p>
                        <p>G√ºnl√ºk takip & raporlama</p>
                    </div>
                    <div class="info">
                        <div class="info-title">üìê V√ºcut √ñl√ß√ºmleri</div>
                        <p>Bel, g√∂ƒü√ºs, kal√ßa, boyun</p>
                        <p>G√ºnl√ºk kayƒ±tlara entegre</p>
                    </div>
                    <div class="info">
                        <div class="info-title">üìà Export</div>
                        <p>Excel & PDF formatƒ±nda</p>
                        <p>T√ºm veriler dahil</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main App -->
        <div id="app" class="hidden">
            <div class="motivation" id="motivation"></div>

            <div class="stats">
                <div class="stat">
                    <div class="stat-label">MEVCUT Kƒ∞LO</div>
                    <div class="stat-value"><span id="currentWeight">--</span><span class="stat-unit">kg</span></div>
                </div>
                <div class="stat">
                    <div class="stat-label">HEDEF Kƒ∞LO</div>
                    <div class="stat-value"><span id="targetWeight">--</span><span class="stat-unit">kg</span></div>
                </div>
                <div class="stat">
                    <div class="stat-label">KALAN</div>
                    <div class="stat-value"><span id="remaining">--</span><span class="stat-unit">kg</span></div>
                </div>
            </div>

            <div class="card" style="margin-bottom: 24px;">
                <h2 class="card-title">üèÜ Ba≈üarƒ±lar</h2>
                <p class="card-subtitle">Kilometre ta≈ülarƒ±nƒ±z</p>
                <div class="achievements" id="achievements"></div>
            </div>

            <div class="grid">
                <div>
                    <div class="card">
                        <h2 class="card-title">G√ºnl√ºk Kayƒ±t</h2>
                        <p class="card-subtitle">Bug√ºn√ºn verileri</p>
                        <form id="entryForm">
                            <div class="input-group">
                                <label class="input-label">Tarih</label>
                                <input type="date" id="entryDate" required>
                            </div>
                            <div class="input-group">
                                <label class="input-label">Kilo (kg)</label>
                                <div class="input-wrapper">
                                    <span class="input-icon">‚öñÔ∏è</span>
                                    <input type="number" id="entryWeight" step="0.1" placeholder="75.5" required>
                                </div>
                            </div>
                            <div class="measurements">
                                <div>
                                    <div class="input-wrapper">
                                        <span class="input-icon">üìè</span>
                                        <input type="number" id="waist" step="0.1" placeholder="Bel (cm)">
                                    </div>
                                </div>
                                <div>
                                    <div class="input-wrapper">
                                        <span class="input-icon">üìè</span>
                                        <input type="number" id="chest" step="0.1" placeholder="G√∂ƒü√ºs (cm)">
                                    </div>
                                </div>
                                <div>
                                    <div class="input-wrapper">
                                        <span class="input-icon">üìè</span>
                                        <input type="number" id="hips" step="0.1" placeholder="Kal√ßa (cm)">
                                    </div>
                                </div>
                                <div>
                                    <div class="input-wrapper">
                                        <span class="input-icon">üìè</span>
                                        <input type="number" id="neck" step="0.1" placeholder="Boyun (cm)">
                                    </div>
                                </div>
                                <div>
                                    <div class="input-wrapper">
                                        <span class="input-icon">üíß</span>
                                        <input type="number" id="entryWater" placeholder="Su (ml)">
                                    </div>
                                </div>
                                <div>
                                    <div class="input-wrapper">
                                        <span class="input-icon">üçé</span>
                                        <input type="number" id="entryCal" placeholder="Kalori (kcal)">
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn">Kaydet</button>
                        </form>

                        <div class="tracker">
                            <div class="tracker-header">
                                <div>
                                    <div class="stat-label">üíß SU</div>
                                    <div class="tracker-goal"><span id="waterCur">0</span> / <span id="waterGoal">0</span> ml</div>
                                </div>
                            </div>
                            <div class="tracker-progress"><div class="tracker-fill" id="waterProg"></div></div>
                            <div class="tracker-btns">
                                <button class="tracker-btn" onclick="addWater(250)">+250ml</button>
                                <button class="tracker-btn" onclick="addWater(500)">+500ml</button>
                                <button class="tracker-btn" onclick="resetWater()">Sƒ±fƒ±rla</button>
                            </div>
                        </div>

                        <div class="tracker calorie">
                            <div class="tracker-header">
                                <div>
                                    <div class="stat-label">üçé KALORƒ∞</div>
                                    <div class="tracker-goal"><span id="calCur">0</span> / <span id="calGoal">0</span> kcal</div>
                                </div>
                            </div>
                            <div class="tracker-progress"><div class="tracker-fill" id="calProg"></div></div>
                            <div class="tracker-btns">
                                <button class="tracker-btn" onclick="addCal(100)">+100</button>
                                <button class="tracker-btn" onclick="addCal(500)">+500</button>
                                <button class="tracker-btn" onclick="resetCal()">Sƒ±fƒ±rla</button>
                            </div>
                        </div>
                    </div>

                    <div class="card" style="margin-top: 24px;">
                        <h2 class="card-title">Detaylar</h2>
                        <p class="card-subtitle">Ek bilgiler</p>
                        <div class="stat" style="margin-bottom: 16px;">
                            <div class="stat-label">TOPLAM DEƒûƒ∞≈ûƒ∞M</div>
                            <div class="stat-value"><span id="totalChange">--</span><span class="stat-unit">kg</span></div>
                        </div>
                        <div class="stat" style="margin-bottom: 16px;">
                            <div class="stat-label">HEDEF TARƒ∞Hƒ∞</div>
                            <div class="stat-value" style="font-size: 18px;"><span id="targetDate">--</span></div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">TAHMƒ∞Nƒ∞ BA≈ûARI</div>
                            <div class="stat-value" style="font-size: 18px;"><span id="estDate">--</span></div>
                        </div>
                        <div id="estBox" class="info hidden"><p id="estText"></p></div>
                    </div>

                    <div class="card" style="margin-top: 24px;">
                        <h2 class="card-title">Export</h2>
                        <p class="card-subtitle">Verilerinizi indirin</p>
                        <div class="export-btns">
                            <button class="btn btn-success" onclick="exportExcel()">üìä Excel</button>
                            <button class="btn btn-success" onclick="exportPDF()">üìÑ PDF</button>
                        </div>
                    </div>

                    <button class="btn btn-danger" onclick="resetApp()" style="margin-top: 24px;">Sƒ±fƒ±rla</button>
                </div>

                <div>
                    <div class="card">
                        <h2 class="card-title">ƒ∞lerleme Grafiƒüi</h2>
                        <p class="card-subtitle">Tƒ±klayarak detay g√∂r√ºn</p>
                        <canvas id="chart"></canvas>
                    </div>

                    <div class="card">
                        <h2 class="card-title">ƒ∞lerleme & BMI</h2>
                        <p class="card-subtitle">Hedef yolculuƒüunuz</p>
                        <div class="progress">
                            <div class="stat-label">ƒ∞LERLEME</div>
                            <div class="stat-value" style="margin-bottom: 8px;"><span id="prog">0</span>%</div>
                            <div class="progress-bar"><div class="progress-fill" id="progBar"></div></div>
                        </div>
                        <div class="bmi">
                            <div class="bmi-value" id="bmi">--</div>
                            <div class="bmi-cat" id="bmiCat">BMI</div>
                        </div>
                    </div>

                    <div class="card" style="margin-top: 24px;">
                        <h2 class="card-title">Son Kayƒ±tlar</h2>
                        <p class="card-subtitle">En son 10 kayƒ±t</p>
                        <div class="entries" id="entries"></div>
                    </div>
                </div>
            </div>

            <div class="credit">
                <p>Tasarƒ±m & Geli≈ütirme</p>
                <p class="name">Metin Demirtel</p>
            </div>
        </div>
    </div>

    <!-- Guide Modal -->
    <div class="modal" id="guideModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeGuide()">‚úï</button>
            <h2 style="font-size: 28px; font-weight: 800; margin-bottom: 8px;">üìñ Kullanƒ±m Rehberi</h2>
            <p style="color: #6c757d; font-size: 14px; margin-bottom: 32px;">Platform √∂zellikleri ve hesaplamalar</p>

            <div class="info" style="margin-top: 0;">
                <div class="info-title">üéØ Platform</div>
                <p>Kilo, su, kalori ve v√ºcut √∂l√ß√ºmlerinizi takip edin</p>
                <p>T√ºm veriler cihazƒ±nƒ±zda g√ºvenle saklanƒ±r</p>
            </div>

            <h3 style="font-size: 18px; font-weight: 800; margin: 24px 0 16px;">Temel √ñzellikler</h3>

            <div class="guide-step">
                <div class="guide-num">1</div>
                <div>
                    <h3>G√ºnl√ºk Kayƒ±t</h3>
                    <p>Her g√ºn kilonuzu ve opsiyonel olarak v√ºcut √∂l√ß√ºmlerinizi girin</p>
                </div>
            </div>

            <div class="guide-step">
                <div class="guide-num">2</div>
                <div>
                    <h3>Su Takibi</h3>
                    <p>G√ºnl√ºk su hedefiniz otomatik hesaplanƒ±r. +250ml ve +500ml ile hƒ±zlƒ±ca ekleyin</p>
                </div>
            </div>

            <div class="guide-step">
                <div class="guide-num">3</div>
                <div>
                    <h3>Kalori Takibi</h3>
                    <p>BMR ve TDEE'ye g√∂re ki≈üisel kalori hedefiniz belirlenir</p>
                </div>
            </div>

            <div class="guide-step">
                <div class="guide-num">4</div>
                <div>
                    <h3>Grafik</h3>
                    <p>Grafiƒüe tƒ±klayarak o g√ºne ait t√ºm detaylarƒ± g√∂r√ºn</p>
                </div>
            </div>

            <h3 style="font-size: 18px; font-weight: 800; margin: 24px 0 16px;">Hesaplamalar</h3>

            <div class="info" style="margin-top: 0;">
                <div class="info-title">üíß Su Hedefi</div>
                <p><strong>Erkek:</strong> Kilo √ó 37.5 ml</p>
                <p><strong>Kadƒ±n:</strong> Kilo √ó 32.5 ml</p>
                <div class="formula">
                    <code>√ñrnek (80kg erkek): 80 √ó 37.5 = 3000 ml</code>
                </div>
            </div>

            <div class="info">
                <div class="info-title">üçé Kalori Hedefi</div>
                <p><strong>BMR Hesaplama:</strong></p>
                <div class="formula">
                    <code>Erkek: 88.362 + (13.397√ókg) + (4.799√ócm) - (5.677√óya≈ü)</code>
                    <code>Kadƒ±n: 447.593 + (9.247√ókg) + (3.098√ócm) - (4.330√óya≈ü)</code>
                </div>
                <p><strong>TDEE:</strong> BMR √ó 1.5 (hafif aktif)</p>
                <p><strong>Hedef:</strong></p>
                <div class="formula">
                    <code>Kilo Verme: TDEE - 500 kcal</code>
                    <code>Kilo Alma: TDEE + 300 kcal</code>
                </div>
            </div>

            <div class="info">
                <div class="info-title">üìä BMI</div>
                <div class="formula">
                    <code>BMI = Kilo √∑ (Boy(m))¬≤</code>
                    <code>&lt;18.5: Zayƒ±f | 18.5-24.9: Normal</code>
                    <code>25-29.9: Fazla Kilolu | ‚â•30: Obez</code>
                </div>
            </div>

            <div class="info">
                <div class="info-title">‚ú® ƒ∞pu√ßlarƒ±</div>
                <p>üìÖ Her sabah aynƒ± saatte tartƒ±lƒ±n</p>
                <p>üíß Su takibini d√ºzenli yapƒ±n</p>
                <p>üçé Kalori giri≈üinde d√ºr√ºst olun</p>
                <p>üìè Haftada bir √∂l√ß√ºm g√ºncelleyin</p>
                <p>üéØ Ger√ßek√ßi hedefler belirleyin</p>
            </div>

            <button class="btn" onclick="closeGuide()">Ba≈ülayalƒ±m!</button>
        </div>
    </div>

    <!-- Chart Detail Modal -->
    <div class="modal" id="detailModal">
        <div class="modal-content" style="max-width: 700px;">
            <button class="close-btn" onclick="closeDetail()">‚úï</button>
            <div id="detail"></div>
        </div>
    </div>

    <script>
const quotes = ["Ba≈üarƒ±, k√º√ß√ºk √ßabalarƒ±n her g√ºn tekrarlanmasƒ±dƒ±r. üí™","Hedefe giden yolda her adƒ±m bir zaferdir! üéØ","Bug√ºnk√º √ßaban, yarƒ±nƒ±n gururudur. ‚ú®","Sen yapabilirsin! ƒ∞nan√ß yarƒ± yoldur. üåü","Deƒüi≈üim bir s√ºre√ßtir, sabƒ±rlƒ± ol. üå±","Kendine inan, her ≈üey m√ºmk√ºn! üöÄ","K√º√ß√ºk adƒ±mlar b√ºy√ºk sonu√ßlar yaratƒ±r. üë£","Hedefin seni bekliyor, devam et! üèÜ","Her g√ºn daha g√º√ßl√ºs√ºn! üíé","Ba≈üarƒ±, azmin √∂d√ºl√ºd√ºr. üî•"];

const badges = [
    {id:'first',name:'ƒ∞lk Kayƒ±t',icon:'üéØ',check:d=>d.entries.length>=1},
    {id:'week',name:'7 G√ºn',icon:'üìÖ',check:d=>d.entries.length>=7},
    {id:'month',name:'1 Ay',icon:'üî•',check:d=>d.entries.length>=30},
    {id:'kg25',name:'2.5 kg',icon:'üí™',check:d=>Math.abs(d.entries[d.entries.length-1].weight-d.startWeight)>=2.5},
    {id:'kg5',name:'5 kg',icon:'‚≠ê',check:d=>Math.abs(d.entries[d.entries.length-1].weight-d.startWeight)>=5},
    {id:'kg10',name:'10 kg',icon:'üèÜ',check:d=>Math.abs(d.entries[d.entries.length-1].weight-d.startWeight)>=10},
    {id:'half',name:'%50',icon:'üéñÔ∏è',check:d=>{const c=d.entries[d.entries.length-1].weight;return Math.abs(d.startWeight-c)/Math.abs(d.startWeight-d.targetWeight)>=0.5}},
    {id:'goal',name:'Hedef!',icon:'üëë',check:d=>{const c=d.entries[d.entries.length-1].weight;return d.startWeight>d.targetWeight?c<=d.targetWeight:c>=d.targetWeight}}
];

let data = {gender:null,age:null,startDate:null,targetDate:null,height:null,startWeight:null,targetWeight:null,waterGoal:0,calGoal:0,bmr:0,tdee:0,entries:[],unlocked:[],dailyWater:{date:null,amount:0},dailyCal:{date:null,amount:0}};
let chart = null;

window.onload = () => {
    load();
    setToday();
    if(data.startDate) showApp();
    
    // Add event listener to sync form with trackers when date changes
    if(document.getElementById('entryDate')) {
        document.getElementById('entryDate').addEventListener('change', function() {
            const t = new Date().toISOString().split('T')[0];
            if(this.value === t) {
                // If today, populate with tracker values
                if(data.dailyWater.amount > 0) {
                    document.getElementById('entryWater').value = data.dailyWater.amount;
                }
                if(data.dailyCal.amount > 0) {
                    document.getElementById('entryCal').value = data.dailyCal.amount;
                }
            }
        });
    }
};

function setToday() {
    const t = new Date().toISOString().split('T')[0];
    document.getElementById('startDate').value = t;
    document.getElementById('entryDate').value = t;
    const m = new Date();
    m.setMonth(m.getMonth()+3);
    document.getElementById('targetDate').value = m.toISOString().split('T')[0];
}

function load() {
    const s = localStorage.getItem('healthTrackerTR');
    if(s) {
        data = JSON.parse(s);
        const t = new Date().toISOString().split('T')[0];
        if(data.dailyWater.date !== t) data.dailyWater = {date:t,amount:0};
        if(data.dailyCal.date !== t) data.dailyCal = {date:t,amount:0};
        save();
    }
}

function save() {
    localStorage.setItem('healthTrackerTR', JSON.stringify(data));
}

function calcBMR(w,h,a,g) {
    return g==='male' ? 88.362+(13.397*w)+(4.799*h)-(5.677*a) : 447.593+(9.247*w)+(3.098*h)-(4.330*a);
}

function calcWater(w,g) {
    return Math.round(w * (g==='male'?37.5:32.5));
}

function calcCal(bmr,sw,tw) {
    const tdee = bmr*1.5;
    return Math.round(sw>tw ? tdee-500 : tdee+300);
}

function showQuote() {
    document.getElementById('motivation').textContent = quotes[Math.floor(Math.random()*quotes.length)];
}

function showGuide() {
    document.getElementById('guideModal').style.display = 'block';
}

function closeGuide() {
    document.getElementById('guideModal').style.display = 'none';
}

document.getElementById('setupForm').addEventListener('submit', e => {
    e.preventDefault();
    data.gender = document.getElementById('gender').value;
    data.age = parseInt(document.getElementById('age').value);
    data.startDate = document.getElementById('startDate').value;
    data.targetDate = document.getElementById('targetDate').value;
    data.height = parseFloat(document.getElementById('height').value);
    data.startWeight = parseFloat(document.getElementById('startWeight').value);
    data.targetWeight = parseFloat(document.getElementById('targetWeight').value);
    
    if(new Date(data.targetDate) <= new Date(data.startDate)) {
        alert('Hedef tarihi ba≈ülangƒ±√ßtan sonra olmalƒ±!');
        return;
    }
    
    data.bmr = calcBMR(data.startWeight,data.height,data.age,data.gender);
    data.tdee = data.bmr*1.5;
    data.waterGoal = calcWater(data.startWeight,data.gender);
    data.calGoal = calcCal(data.bmr,data.startWeight,data.targetWeight);
    
    const t = new Date().toISOString().split('T')[0];
    data.dailyWater = {date:t,amount:0};
    data.dailyCal = {date:t,amount:0};
    data.entries = [{date:data.startDate,weight:data.startWeight,waist:null,chest:null,hips:null,neck:null,water:0,calories:0}];
    data.unlocked = [];
    
    save();
    showApp();
});

function showApp() {
    document.getElementById('setup').classList.add('hidden');
    document.getElementById('app').classList.remove('hidden');
    showQuote();
    updateStats();
    updateChart();
    updateEntries();
    updateBadges();
    updateWater();
    updateCal();
    setInterval(showQuote,10000);
}

function updateBadges() {
    const g = document.getElementById('achievements');
    g.innerHTML = '';
    badges.forEach(b => {
        const u = b.check(data);
        if(u && !data.unlocked.includes(b.id)) {
            data.unlocked.push(b.id);
            save();
        }
        const d = document.createElement('div');
        d.className = 'achievement' + (u?' unlocked':'');
        d.innerHTML = `<div class="achievement-icon">${b.icon}</div><div class="achievement-name">${b.name}</div>`;
        g.appendChild(d);
    });
}

function updateWater() {
    const c = data.dailyWater.amount;
    const g = data.waterGoal;
    const p = Math.min((c/g)*100,100);
    document.getElementById('waterCur').textContent = c;
    document.getElementById('waterGoal').textContent = g;
    document.getElementById('waterProg').style.width = p+'%';
}

function updateCal() {
    const c = data.dailyCal.amount;
    const g = data.calGoal;
    const p = Math.min((c/g)*100,100);
    document.getElementById('calCur').textContent = c;
    document.getElementById('calGoal').textContent = g;
    document.getElementById('calProg').style.width = p+'%';
}

function addWater(a) {
    const t = new Date().toISOString().split('T')[0];
    if(data.dailyWater.date !== t) data.dailyWater = {date:t,amount:0};
    data.dailyWater.amount += a;
    
    // Update form field if today
    const entryDate = document.getElementById('entryDate').value;
    if(entryDate === t) {
        document.getElementById('entryWater').value = data.dailyWater.amount;
    }
    
    save();
    updateWater();
}

function resetWater() {
    const t = new Date().toISOString().split('T')[0];
    data.dailyWater = {date:t,amount:0};
    
    // Update form field if today
    const entryDate = document.getElementById('entryDate').value;
    if(entryDate === t) {
        document.getElementById('entryWater').value = '';
    }
    
    save();
    updateWater();
}

function addCal(a) {
    const t = new Date().toISOString().split('T')[0];
    if(data.dailyCal.date !== t) data.dailyCal = {date:t,amount:0};
    data.dailyCal.amount += a;
    
    // Update form field if today
    const entryDate = document.getElementById('entryDate').value;
    if(entryDate === t) {
        document.getElementById('entryCal').value = data.dailyCal.amount;
    }
    
    save();
    updateCal();
}

function resetCal() {
    const t = new Date().toISOString().split('T')[0];
    data.dailyCal = {date:t,amount:0};
    
    // Update form field if today
    const entryDate = document.getElementById('entryDate').value;
    if(entryDate === t) {
        document.getElementById('entryCal').value = '';
    }
    
    save();
    updateCal();
}

function updateStats() {
    const cur = data.entries[data.entries.length-1];
    const cw = cur.weight;
    const tw = data.targetWeight;
    const sw = data.startWeight;
    const ch = cw-sw;
    const rem = cw-tw;
    const goal = sw-tw;
    const prog = Math.abs(goal)>0 ? (Math.abs(ch)/Math.abs(goal))*100 : 0;
    
    document.getElementById('currentWeight').textContent = cw.toFixed(1);
    document.getElementById('targetWeight').textContent = tw.toFixed(1);
    document.getElementById('remaining').textContent = Math.abs(rem).toFixed(1);
    document.getElementById('totalChange').textContent = (ch>=0?'+':'')+ch.toFixed(1);
    
    const pp = Math.min(prog,100);
    document.getElementById('progBar').style.width = pp+'%';
    document.getElementById('prog').textContent = Math.round(pp);
    
    const td = new Date(data.targetDate);
    document.getElementById('targetDate').textContent = td.toLocaleDateString('tr-TR',{day:'numeric',month:'short',year:'numeric'});
    
    if(data.entries.length>=2) {
        const f = data.entries[0];
        const l = data.entries[data.entries.length-1];
        const fd = new Date(f.date);
        const ld = new Date(l.date);
        const days = Math.max(1,(ld-fd)/(1000*60*60*24));
        const wch = l.weight-f.weight;
        const rate = wch/days;
        
        if(Math.abs(rate)>0.001) {
            const remw = tw-cw;
            const need = remw/rate;
            const est = new Date(ld);
            est.setDate(est.getDate()+Math.round(need));
            
            document.getElementById('estDate').textContent = est.toLocaleDateString('tr-TR',{day:'numeric',month:'short',year:'numeric'});
            
            const box = document.getElementById('estBox');
            const txt = document.getElementById('estText');
            box.classList.remove('hidden');
            
            const wr = rate*7;
            let msg = `üìä G√ºnde ${Math.abs(rate).toFixed(2)} kg, haftada ${Math.abs(wr).toFixed(2)} kg gidi≈üatla `;
            
            if(Math.abs((est-td)/(1000*60*60*24))<=7) {
                msg += 'tam zamanƒ±nda! üéØ';
            } else if(est<td) {
                const ed = Math.round((td-est)/(1000*60*60*24));
                msg += `${ed} g√ºn √∂nce! üöÄ`;
            } else {
                const du = (td-ld)/(1000*60*60*24);
                const nr = Math.abs(remw/du);
                msg += `g√ºnl√ºk ${nr.toFixed(2)} kg gerekli. ‚ö°`;
            }
            txt.textContent = msg;
        } else {
            document.getElementById('estDate').textContent = 'Veri yetersiz';
            document.getElementById('estBox').classList.add('hidden');
        }
    } else {
        document.getElementById('estDate').textContent = 'Veri yetersiz';
        document.getElementById('estBox').classList.add('hidden');
    }
    
    const hm = data.height/100;
    const bmi = cw/(hm*hm);
    document.getElementById('bmi').textContent = bmi.toFixed(1);
    
    let cat = '';
    if(bmi<18.5) cat='Zayƒ±f';
    else if(bmi<25) cat='Normal';
    else if(bmi<30) cat='Fazla Kilolu';
    else cat='Obez';
    
    document.getElementById('bmiCat').textContent = cat+' (BMI: '+bmi.toFixed(1)+')';
    updateBadges();
}

function updateChart() {
    const ctx = document.getElementById('chart').getContext('2d');
    if(chart) chart.destroy();
    
    const labels = data.entries.map(e => {
        const d = new Date(e.date);
        return d.toLocaleDateString('tr-TR',{day:'numeric',month:'short'});
    });
    
    const weights = data.entries.map(e => e.weight);
    const target = data.entries.map(() => data.targetWeight);
    
    chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Kilonuz',
                data: weights,
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59,130,246,0.1)',
                tension: 0.4,
                fill: true,
                pointRadius: 6,
                pointHoverRadius: 8,
                pointBackgroundColor: '#3b82f6',
                pointBorderColor: '#fff',
                pointBorderWidth: 2
            },{
                label: 'Hedef',
                data: target,
                borderColor: '#6c757d',
                borderDash: [8,4],
                pointRadius: 0,
                fill: false,
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            onClick: (e,els) => {
                if(els.length>0) showDetail(els[0].index);
            },
            interaction: {mode:'index',intersect:false},
            plugins: {
                legend: {display:true,position:'top',labels:{padding:20,font:{size:13,weight:'700',family:"'Plus Jakarta Sans',sans-serif"},usePointStyle:true}},
                tooltip: {enabled:true,backgroundColor:'rgba(0,0,0,0.8)',padding:12,cornerRadius:8,displayColors:false,callbacks:{title:()=>'Detaylar i√ßin tƒ±klayƒ±n',label:c=>c.parsed.y.toFixed(1)+' kg'}}
            },
            scales: {
                y: {beginAtZero:false,grid:{color:'rgba(0,0,0,0.05)',drawBorder:false},ticks:{padding:10,font:{size:12,weight:'600'},callback:v=>v+' kg'}},
                x: {grid:{display:false,drawBorder:false},ticks:{padding:10,font:{size:12,weight:'600'}}}
            }
        }
    });
}

function showDetail(i) {
    const e = data.entries[i];
    const w = e.weight;
    const d = new Date(e.date);
    const cs = w - data.startWeight;
    const cp = i>0 ? w-data.entries[i-1].weight : 0;
    const hm = data.height/100;
    const bmi = w/(hm*hm);
    const goal = data.startWeight - data.targetWeight;
    const ach = data.startWeight - w;
    const prog = (ach/goal)*100;
    
    let cat = '';
    if(bmi<18.5) cat='Zayƒ±f';
    else if(bmi<25) cat='Normal';
    else if(bmi<30) cat='Fazla Kilolu';
    else cat='Obez';
    
    let h = `<div style="color:#6c757d;font-size:13px;font-weight:700;text-transform:uppercase;margin-bottom:16px;">${d.toLocaleDateString('tr-TR',{weekday:'long',day:'numeric',month:'long',year:'numeric'})}</div>`;
    h += `<div style="font-size:56px;font-weight:900;margin-bottom:24px;">${w.toFixed(1)} kg</div>`;
    h += '<div style="display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-bottom:24px;">';
    h += `<div class="stat"><div class="stat-label">BMI</div><div class="stat-value" style="font-size:24px;">${bmi.toFixed(1)}</div><div style="color:#6c757d;font-size:11px;font-weight:600;margin-top:4px;">${cat}</div></div>`;
    h += `<div class="stat"><div class="stat-label">BA≈ûLANGI√áTAN</div><div class="stat-value" style="font-size:24px;color:${cs<0?'#10b981':'#ef4444'};">${cs>=0?'+':''}${cs.toFixed(1)} kg</div></div>`;
    if(i>0) h += `<div class="stat"><div class="stat-label">√ñNCEKƒ∞DEN</div><div class="stat-value" style="font-size:24px;color:${cp<0?'#10b981':'#ef4444'};">${cp>=0?'+':''}${cp.toFixed(1)} kg</div></div>`;
    h += `<div class="stat"><div class="stat-label">HEDEFE KALAN</div><div class="stat-value" style="font-size:24px;">${Math.abs(w-data.targetWeight).toFixed(1)} kg</div></div>`;
    
    if(e.waist) h += `<div class="stat"><div class="stat-label">BEL</div><div class="stat-value" style="font-size:24px;">${e.waist} cm</div></div>`;
    if(e.chest) h += `<div class="stat"><div class="stat-label">G√ñƒû√úS</div><div class="stat-value" style="font-size:24px;">${e.chest} cm</div></div>`;
    if(e.hips) h += `<div class="stat"><div class="stat-label">KAL√áA</div><div class="stat-value" style="font-size:24px;">${e.hips} cm</div></div>`;
    if(e.neck) h += `<div class="stat"><div class="stat-label">BOYUN</div><div class="stat-value" style="font-size:24px;">${e.neck} cm</div></div>`;
    if(e.water>0) h += `<div class="stat"><div class="stat-label">SU</div><div class="stat-value" style="font-size:24px;color:#3b82f6;">${e.water} ml</div></div>`;
    if(e.calories>0) h += `<div class="stat"><div class="stat-label">KALORƒ∞</div><div class="stat-value" style="font-size:24px;color:#10b981;">${e.calories} kcal</div></div>`;
    
    h += '</div>';
    h += `<div class="progress"><div class="stat-label">ƒ∞LERLEME</div><div class="stat-value" style="margin-bottom:8px;">${Math.min(100,prog).toFixed(1)}%</div><div class="progress-bar"><div class="progress-fill" style="width:${Math.min(100,prog)}%"></div></div></div>`;
    
    document.getElementById('detail').innerHTML = h;
    document.getElementById('detailModal').style.display = 'block';
}

function closeDetail() {
    document.getElementById('detailModal').style.display = 'none';
}

document.getElementById('guideModal').addEventListener('click', e => {if(e.target===e.currentTarget) closeGuide()});
document.getElementById('detailModal').addEventListener('click', e => {if(e.target===e.currentTarget) closeDetail()});

document.getElementById('entryForm').addEventListener('submit', e => {
    e.preventDefault();
    const d = document.getElementById('entryDate').value;
    const w = parseFloat(document.getElementById('entryWeight').value);
    const wa = parseFloat(document.getElementById('waist').value) || null;
    const ch = parseFloat(document.getElementById('chest').value) || null;
    const hi = parseFloat(document.getElementById('hips').value) || null;
    const ne = parseFloat(document.getElementById('neck').value) || null;
    
    // Get water and calorie from form inputs
    const waterInput = parseInt(document.getElementById('entryWater').value) || 0;
    const calInput = parseInt(document.getElementById('entryCal').value) || 0;
    
    // Sync with trackers if it's today
    const t = new Date().toISOString().split('T')[0];
    let water = waterInput;
    let cal = calInput;
    
    if(d === t) {
        // Update trackers with form values
        if(waterInput > 0) {
            data.dailyWater.amount = waterInput;
            updateWater();
        }
        if(calInput > 0) {
            data.dailyCal.amount = calInput;
            updateCal();
        }
        // Use tracker values for saving
        water = data.dailyWater.amount;
        cal = data.dailyCal.amount;
    }
    
    const ei = data.entries.findIndex(e => e.date===d);
    const entry = {date:d,weight:w,waist:wa,chest:ch,hips:hi,neck:ne,water:water,calories:cal};
    
    if(ei!==-1) {
        if(confirm('Bu tarih i√ßin kayƒ±t var. G√ºncellensin mi?')) {
            data.entries[ei] = entry;
        }
    } else {
        data.entries.push(entry);
        data.entries.sort((a,b) => new Date(a.date)-new Date(b.date));
    }
    
    save();
    updateStats();
    updateChart();
    updateEntries();
    
    document.getElementById('entryWeight').value = '';
    document.getElementById('waist').value = '';
    document.getElementById('chest').value = '';
    document.getElementById('hips').value = '';
    document.getElementById('neck').value = '';
    document.getElementById('entryWater').value = '';
    document.getElementById('entryCal').value = '';
    setToday();
});

function updateEntries() {
    const list = document.getElementById('entries');
    list.innerHTML = '';
    const recent = [...data.entries].reverse().slice(0,10);
    
    recent.forEach(e => {
        const d = document.createElement('div');
        d.className = 'entry';
        const dt = new Date(e.date);
        const ds = dt.toLocaleDateString('tr-TR',{day:'numeric',month:'long',year:'numeric'});
        
        let det = '';
        if(e.waist) det += `<div class="entry-detail"><div class="entry-detail-label">Bel</div><div class="entry-detail-value">${e.waist} cm</div></div>`;
        if(e.chest) det += `<div class="entry-detail"><div class="entry-detail-label">G√∂ƒü√ºs</div><div class="entry-detail-value">${e.chest} cm</div></div>`;
        if(e.hips) det += `<div class="entry-detail"><div class="entry-detail-label">Kal√ßa</div><div class="entry-detail-value">${e.hips} cm</div></div>`;
        if(e.neck) det += `<div class="entry-detail"><div class="entry-detail-label">Boyun</div><div class="entry-detail-value">${e.neck} cm</div></div>`;
        if(e.water>0) det += `<div class="entry-detail"><div class="entry-detail-label">Su</div><div class="entry-detail-value">${e.water} ml</div></div>`;
        if(e.calories>0) det += `<div class="entry-detail"><div class="entry-detail-label">Kalori</div><div class="entry-detail-value">${e.calories} kcal</div></div>`;
        
        d.innerHTML = `
            <div class="entry-header">
                <span class="entry-date">${ds}</span>
                <span class="entry-weight">${e.weight.toFixed(1)} kg</span>
            </div>
            ${det?'<div class="entry-details">'+det+'</div>':''}
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:${det?'12px':'0'};">
                <button class="btn" style="width:100%;padding:8px;font-size:12px;" onclick="editEntry('${e.date}')">D√ºzenle</button>
                <button class="btn btn-danger" style="width:100%;padding:8px;font-size:12px;" onclick="deleteEntry('${e.date}')">Sil</button>
            </div>
        `;
        list.appendChild(d);
    });
}

function editEntry(d) {
    const e = data.entries.find(entry => entry.date === d);
    if(!e) return;
    
    document.getElementById('entryDate').value = e.date;
    document.getElementById('entryWeight').value = e.weight;
    document.getElementById('waist').value = e.waist || '';
    document.getElementById('chest').value = e.chest || '';
    document.getElementById('hips').value = e.hips || '';
    document.getElementById('neck').value = e.neck || '';
    document.getElementById('entryWater').value = e.water || '';
    document.getElementById('entryCal').value = e.calories || '';
    
    // Scroll to form
    document.getElementById('entryForm').scrollIntoView({behavior: 'smooth', block: 'center'});
}

function deleteEntry(d) {
    if(data.entries.length<=1) {
        alert('En az bir kayƒ±t olmalƒ±!');
        return;
    }
    if(confirm('Bu kaydƒ± silmek istediƒüinizden emin misiniz?')) {
        data.entries = data.entries.filter(e => e.date!==d);
        save();
        updateStats();
        updateChart();
        updateEntries();
    }
}

function exportExcel() {
    const wb = XLSX.utils.book_new();
    
    const wd = data.entries.map(e => ({
        Tarih: new Date(e.date).toLocaleDateString('tr-TR'),
        'Kilo (kg)': e.weight,
        'Bel (cm)': e.waist||'-',
        'Gogus (cm)': e.chest||'-',
        'Kalca (cm)': e.hips||'-',
        'Boyun (cm)': e.neck||'-',
        'Su (ml)': e.water||0,
        'Kalori (kcal)': e.calories||0
    }));
    const ws1 = XLSX.utils.json_to_sheet(wd);
    XLSX.utils.book_append_sheet(wb, ws1, 'Gunluk Kayitlar');
    
    const sum = [{
        'Baslangic Tarihi': new Date(data.startDate).toLocaleDateString('tr-TR'),
        'Hedef Tarihi': new Date(data.targetDate).toLocaleDateString('tr-TR'),
        'Baslangic Kilosu': data.startWeight+' kg',
        'Hedef Kilo': data.targetWeight+' kg',
        'Mevcut Kilo': data.entries[data.entries.length-1].weight+' kg',
        'Toplam Degisim': (data.entries[data.entries.length-1].weight-data.startWeight).toFixed(1)+' kg',
        'Boy': data.height+' cm',
        'Yas': data.age,
        'Cinsiyet': data.gender==='male'?'Erkek':'Kadin',
        'Gunluk Su Hedefi': data.waterGoal+' ml',
        'Gunluk Kalori Hedefi': data.calGoal+' kcal',
        'BMR': data.bmr.toFixed(0)+' kcal',
        'TDEE': data.tdee.toFixed(0)+' kcal'
    }];
    const ws2 = XLSX.utils.json_to_sheet(sum);
    XLSX.utils.book_append_sheet(wb, ws2, 'Ozet');
    
    XLSX.writeFile(wb, 'saglik-takip.xlsx', {bookType: 'xlsx', type: 'binary'});
}

function exportPDF() {
    const {jsPDF} = window.jspdf;
    const doc = new jsPDF();
    
    // Helper function to convert Turkish chars
    const tr = (text) => {
        return text
            .replace(/ƒü/g, 'g').replace(/ƒû/g, 'G')
            .replace(/√º/g, 'u').replace(/√ú/g, 'U')
            .replace(/≈ü/g, 's').replace(/≈û/g, 'S')
            .replace(/ƒ±/g, 'i').replace(/ƒ∞/g, 'I')
            .replace(/√∂/g, 'o').replace(/√ñ/g, 'O')
            .replace(/√ß/g, 'c').replace(/√á/g, 'C');
    };
    
    doc.setFontSize(20);
    doc.text(tr('Saƒülƒ±k Takip Raporu'), 20, 20);
    
    doc.setFontSize(12);
    let y = 40;
    doc.text(tr('√ñzet Bilgiler'), 20, y);
    y += 10;
    doc.setFontSize(10);
    doc.text(tr(`Ba≈ülangƒ±√ß: ${new Date(data.startDate).toLocaleDateString('tr-TR')}`), 20, y); y+=7;
    doc.text(tr(`Hedef Tarihi: ${new Date(data.targetDate).toLocaleDateString('tr-TR')}`), 20, y); y+=7;
    doc.text(tr(`Ba≈ülangƒ±√ß: ${data.startWeight} kg`), 20, y); y+=7;
    doc.text(tr(`Hedef: ${data.targetWeight} kg`), 20, y); y+=7;
    doc.text(tr(`Mevcut: ${data.entries[data.entries.length-1].weight} kg`), 20, y); y+=7;
    doc.text(tr(`Deƒüi≈üim: ${(data.entries[data.entries.length-1].weight-data.startWeight).toFixed(1)} kg`), 20, y); y+=7;
    doc.text(tr(`G√ºnl√ºk Su: ${data.waterGoal} ml`), 20, y); y+=7;
    doc.text(tr(`G√ºnl√ºk Kalori: ${data.calGoal} kcal`), 20, y); y+=15;
    
    doc.setFontSize(12);
    doc.text(tr('Son Kayƒ±tlar'), 20, y); y+=10;
    doc.setFontSize(10);
    
    data.entries.slice(-15).reverse().forEach(e => {
        let t = tr(`${new Date(e.date).toLocaleDateString('tr-TR')}: ${e.weight} kg`);
        if(e.waist) t += tr(` | Bel:${e.waist}`);
        if(e.chest) t += tr(` | Gogus:${e.chest}`);
        if(e.hips) t += tr(` | Kalca:${e.hips}`);
        if(e.neck) t += tr(` | Boyun:${e.neck}`);
        if(e.water>0) t += tr(` | Su:${e.water}ml`);
        if(e.calories>0) t += tr(` | Kal:${e.calories}`);
        doc.text(t, 20, y);
        y += 7;
        if(y > 270) {
            doc.addPage();
            y = 20;
        }
    });
    
    // Add footer
    const pageCount = doc.internal.getNumberOfPages();
    for(let i = 1; i <= pageCount; i++) {
        doc.setPage(i);
        doc.setFontSize(8);
        doc.text(tr('Tasarƒ±m: Metin Demirtel'), 20, 285);
        doc.text(tr(`Sayfa ${i} / ${pageCount}`), 180, 285);
    }
    
    doc.save('saglik-takip.pdf');
}

function resetApp() {
    if(confirm('T√ºm verileriniz silinecek. Emin misiniz?')) {
        localStorage.removeItem('healthTrackerTR');
        location.reload();
    }
}
    </script>
</body>
</html>
